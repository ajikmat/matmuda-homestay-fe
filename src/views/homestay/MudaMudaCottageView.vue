<template>
    <main class="flex flex-col mb-12">
        <section class="relative bg-zinc-100 border-b">
            <img
                src="https://images.unsplash.com/photo-1604014237800-1c9102c219da?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
                alt="image"
                class="object-cover w-full h-[500px]"
            />

            <div class="container mx-auto py-12 -mt-48">
                <div class="grid grid-cols-12 gap-8">
                    <div class="flex flex-col lg:col-span-8 col-span-12">
                        <div class="bg-white p-10 rounded-lg shadow-sm border-gray-200 border">
                            <div class="font-bold text-3xl tracking-tight">Mat Muda Cottage</div>
                            <div class="text-gray-500 text-xl mb-4">
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit.
                            </div>

                            <div class="flex justify-between space-x-2 pt-0">
                                <div class="bg-gray-200 rounded-lg border h-20 w-1/4"></div>
                                <div class="bg-gray-200 rounded-lg border h-20 w-1/4"></div>
                                <div class="bg-gray-200 rounded-lg border h-20 w-1/4"></div>
                                <div class="bg-gray-200 rounded-lg border h-20 w-1/4"></div>
                            </div>
                        </div>
                        <div class="bg-white p-10 rounded-lg shadow-sm mt-8 border-gray-200 border">
                            <div class="font-bold text-2xl mb-4">About</div>
                            <div class="text-lg">
                                Lorem ipsum, dolor sit amet consectetur adipisicing elit. Iusto qui assumenda blanditiis
                                officia. Voluptate laboriosam vel sed neque. Reiciendis tempora corrupti sapiente
                                assumenda ipsam vitae iste provident delectus fuga ipsum. Similique beatae dolore
                                nesciunt tenetur ullam repudiandae fugit, vel odio quo facilis aspernatur perspiciatis
                                aliquam soluta numquam distinctio. Molestiae fugiat doloribus voluptas maxime quasi
                                magnam aspernatur cum voluptatum consequuntur sed.
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm mt-8 border-gray-200 border">
                            <div class="font-bold text-2xl mb-6">Aminities</div>
                            <div class="grid grid-cols-6 gap-12">
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="size-14 rounded-full bg-gray-200"></div>
                                    <div class="flex-1 rounded-lg bg-gray-200 ml-6"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-sm mt-8 border-gray-200 border">
                            <div class="font-bold text-2xl mb-4">House rules</div>

                            <div class="grid grid-cols-4 gap-4">
                                <div
                                    class="col-span-1 h-20 w-full rounded-md flex items-center justify-center space-x-3"
                                >
                                    <i class="pi pi-sign-in text-2xl -ml-5"></i>
                                    <div>Check-In</div>
                                </div>
                                <div class="h-20 col-span-3 flex flex-col items-start">
                                    <div class="font-medium">From 14:00 to 00:00</div>
                                    <div>
                                        Guests are required to show a photo identification and credit card upon check-in
                                        You'll need to let the property know in advance what time you'll arrive.
                                    </div>
                                </div>
                                <hr class="col-span-4" />
                                <div
                                    class="col-span-1 h-20 w-full rounded-md flex items-center justify-center space-x-2"
                                >
                                    <i class="pi pi-sign-out text-2xl"></i>
                                    <div>Check-Out</div>
                                </div>
                                <div class="h-20 col-span-3 flex flex-col justify-center">
                                    <div class="font-medium">Available 24 hours</div>
                                </div>
                                <hr class="col-span-4" />
                                <div
                                    class="col-span-1 h-20 w-full rounded-md flex items-center justify-center space-x-3"
                                >
                                    <i class="pi pi-credit-card text-2xl"></i>
                                    <div>Payment</div>
                                </div>
                                <div class="h-20 col-span-3 flex flex-col justify-center">
                                    <div class="font-medium">Via WhatsApp</div>
                                </div>
                                <hr class="col-span-4" />
                                <div
                                    class="col-span-1 h-20 w-full rounded-md flex items-center justify-center space-x-4"
                                >
                                    <i class="pi pi-sign-in text-2xl"></i>
                                    <div>Check-In</div>
                                </div>
                                <div class="h-20 col-span-3 flex flex-col items-start">
                                    <div class="font-medium">From 14:00 to 00:00</div>
                                    <div>
                                        Guests are required to show a photo identification and credit card upon check-in
                                        You'll need to let the property know in advance what time you'll arrive.
                                    </div>
                                </div>
                                <hr class="col-span-4" />
                                <div
                                    class="col-span-1 h-20 w-full rounded-md flex items-center justify-center space-x-4"
                                >
                                    <i class="pi pi-sign-in text-2xl"></i>
                                    <div>Check-In</div>
                                </div>
                                <div class="h-20 col-span-3 flex flex-col items-start">
                                    <div class="font-medium">From 14:00 to 00:00</div>
                                    <div>
                                        Guests are required to show a photo identification and credit card upon check-in
                                        You'll need to let the property know in advance what time you'll arrive.
                                    </div>
                                </div>
                                <hr class="col-span-4" />
                            </div>
                        </div>
                    </div>
                    <div class="col-span-4" ref="scrollTrigger">
                        <div class="bg-white py-8 px-6 rounded-lg shadow-sm border-gray-200 border">
                            <div class="flex flex-col mb-8">
                                <div class="text-2xl font-bold">Book Now</div>
                                <div class="text-gray-500 text-lg">
                                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                                </div>
                            </div>

                            <div class="space-y-2 mt-2">
                                <HomeDate></HomeDate>
                                <HomeGuest></HomeGuest>
                                <HomeBooknow></HomeBooknow>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="">
            <div class="container mx-auto py-20 border-b">
                <Galleria
                    :activeIndex="activeIndex"
                    v-model:visible="visible"
                    :value="images"
                    :responsiveOptions="responsiveOptions"
                    :numVisible="9"
                    containerStyle="max-width: 50%"
                    container-class=" bg-white"
                    :circular="true"
                    :fullScreen="true"
                    :showItemNavigators="true"
                >
                    <template #item="slotProps">
                        <img
                            :src="slotProps.item.imgSrc"
                            :alt="slotProps.item.name"
                            class="aspect-video object-contain"
                        />
                    </template>
                    <template #thumbnail="slotProps">
                        <img
                            :src="slotProps.item.imgSrc"
                            :alt="slotProps.item.name"
                            style="display: block"
                            class="size-24"
                        />
                    </template>
                </Galleria>

                <div class="max-w-[800px] mx-auto">
                    <div class="grid grid-cols-12 gap-1">
                        <div
                            v-for="(image, index) in images"
                            :key="image.name"
                            class="col-span-4"
                            @click="toggleImages(index)"
                        >
                            <div class="relative">
                                <img
                                    :class="index == 5 && 'flex justify-center items-center'"
                                    :src="image.imgSrc"
                                    :alt="image.name"
                                    class="object-cover aspect-video w-full rounded cursor-pointer"
                                />

                                <div
                                    v-if="index == 5"
                                    class="absolute bg-slate-900/50 inset-0 flex flex-col justify-center text-center text-white"
                                >
                                    <span>5+</span>
                                    <span>Photos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="">
            <div class="container mx-auto py-20 flex flex-col border-b">
                <div class="mb-10">
                    <div class="font-bold text-3xl">Where you`ll be</div>
                    <div>Lorem, ipsum dolor sit amet consectetur adipisicing.</div>
                </div>
                <div class="h-[500px]">
                    <!-- <Maps></Maps> -->
                </div>
            </div>
        </section>
        <section class="relative">
            <div class="container flex flex-col justify-center items-center pt-20 mx-auto">
                <div class="flex h-40 mx-auto">
                    <img
                        class="w-20 h-full -mt-1 mr-2"
                        src="https://a0.muscache.com/im/pictures/airbnb-platform-assets/AirbnbPlatformAssets-GuestFavorite/original/78b7687c-5acf-4ef8-a5ea-eda732ae3b2f.png"
                        alt=""
                    />
                    <div class="text-9xl pt-2">{{ overRating }}</div>
                    <img
                        class="w-20 h-full -mt-1 ml-2"
                        src="https://a0.muscache.com/im/pictures/airbnb-platform-assets/AirbnbPlatformAssets-GuestFavorite/original/b4005b30-79ff-4287-860c-67829ecd7412.png"
                        alt=""
                    />
                </div>
                <div class="text-5xl font-medium mb-2">Guest favorite</div>
                <div class="mb-20">This home is a guest favorite based on ratings, reviews, and reliability</div>
                <div class="pb-20">
                    <OverallRating />
                </div>
            </div>
        </section>
        <section>
            <div class="container flex flex-col justify-center items-center">
                <div class="font-bold leading-6 text-2xl p-10">
                    What people Think
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-purple-500"
                        >About US</span
                    >
                </div>
                <div>
                    <CarouselHome :reviewsData="results"></CarouselHome>
                </div>
                <div class="mt-10">
                    <ButtonReview @save-data="saveData"></ButtonReview>
                </div>
            </div>
        </section>
    </main>
</template>

<script>
import { useReviewStore } from '@/stores/reviewStore';
import gsap from 'gsap';
import ScrollTrigger from 'gsap/ScrollTrigger';
gsap.registerPlugin(ScrollTrigger);

import HomeGuest from '@/components/Homestay/HomeGuest.vue';
import HomeDate from '@/components/Homestay/HomeDate.vue';
import OverallRating from '@/components/Homestay/OverallRating.vue';
import Maps from '@/components/Homestay/Maps.vue';
import HomeBooknow from '@/components/Homestay/HomeBooknow.vue';
import CarouselHome from '@/components/Homestay/CarouselHome.vue';
import ButtonReview from '@/components/Homestay/ButtonReview.vue';

export default {
    data() {
        return {
            val: null,
            dataStore: useReviewStore(),
            results: [],
            disabled: true,
            visible: false,
            value: 5,
            activeIndex: 0,
            selectedImages: null,
            responsiveOptions: [
                {
                    breakpoint: '1300px',
                    numVisible: 4,
                },
                {
                    breakpoint: '575px',
                    numVisible: 1,
                },
            ],
            position: 'right',
            images: [
                {
                    name: 'Muda cottage',
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fmuda-cottage-banner.JPG?alt=media',
                },
                {
                    name: 'aDLi.suite',
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fadli-suite-banner.JPG?alt=media',
                },
                {
                    name: "d'Arif Homestay",
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fd-arif-homestay-banner.jpg?alt=media',
                },
                {
                    name: "d'Arif Homestay",
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fd-arif-homestay-banner.jpg?alt=media',
                },
                {
                    name: "d'Arif Homestay",
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fd-arif-homestay-banner.jpg?alt=media',
                },
                {
                    name: "d'Arif Homestay",
                    imgSrc: 'https://firebasestorage.googleapis.com/v0/b/matmuda-homestay.appspot.com/o/discover%2Fd-arif-homestay-banner.jpg?alt=media',
                },
            ],
        };
    },
    mounted() {
        gsap.to(this.$refs.scrollTrigger, {
            y: 1130,
            scrollTrigger: {
                trigger: this.$refs.box,
                start: '200px top',
                scrub: true,
            },
        });
    },
    components: {
        HomeGuest,
        HomeDate,
        OverallRating,
        Maps,
        HomeBooknow,
    },
    created() {
        this.loadReviews();
    },
    computed: {
        overRating() {
            const allValue = this.results.map((result) => result.value);
            const totalRating = allValue.reduce((acc, curr) => acc + curr, 0);

            const overrall = totalRating / allValue.length;

            return overrall;
        },
    },
    methods: {
        saveData(data) {
            this.dataStore.addNewReview(data);
        },
        toggleImages(value) {
            this.visible = true;
            this.activeIndex = value;
        },
        async loadReviews() {
            const response = await fetch(
                `https://muda-homestay-default-rtdb.asia-southeast1.firebasedatabase.app/reviews.json`,
            );

            const responseData = await response.json();

            if (!response.ok) {
                //error
            }
            const reviews = [];

            for (const key in responseData) {
                const review = {
                    name: responseData[key].name,
                    email: responseData[key].email,
                    date: responseData[key].date,
                    value: responseData[key].rating,
                    description: responseData[key].review,
                };

                reviews.push(review);
            }

            this.results = reviews;
        },
    },
};
</script>
